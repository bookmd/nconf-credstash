machine:
  node:
    version: 5.5.0  
  services:
    - docker

dependencies:
  pre:
    - sudo apt-get install openssh-client build-essential libssl-dev libffi-dev python-dev
    - pip install credstash
    - credstash setup

test:
  override:
    - docker run -itd -p 24:24 -e SSH_PORT=24 --env-file <(env | grep AWS) -v ~/.ssh/id_rsa.pub:/root/.ssh/authorized_keys --name credstash_host bookmd/docker-credstash-host
    - sudo lxc-attach -n "$(docker inspect --format "{{.Id}}" credstash_host)" -- bash -c credstash setup
    - CREDSTAH_HOST=localhost
    - npm test

general:
  artifacts:
    - ./coverage